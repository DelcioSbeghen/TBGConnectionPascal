unit TBGZeosDriver.Model.Conexao;

interface

uses
  TBGConnection.Model.Interfaces, System.Classes,
  ZConnection, Data.DB, TBGConnection.Model.DataSet.Interfaces;

Type
  TZeosDriverModelConexao = class(TInterfacedObject, iConexao)
    private
      FConnection : TZConnection;
      FCache : iDriverProxy;
      FLimitCacheRegister : Integer;
    public
      constructor Create(Connection : TZConnection);
      destructor Destroy; override;
      class function New(Connection : TZConnection) : iConexao;
      //iConexao
      function Cache : iDriverProxy;
      function Conectar : iConexao;
      function &End: TComponent;
      function Connection : TCustomConnection;
      function StartTransaction : iConexao;
      function RollbackTransaction : iConexao;
      function Commit : iConexao;
      function LimitCacheRegister(Value : Integer) : iConexao;
  end;

implementation

uses
  System.SysUtils, TBGConnection.Model.DataSet.Proxy;

{ TZeosDriverModelConexao }

function TZeosDriverModelConexao.Cache: iDriverProxy;
begin
  Result := FCache;
end;

function TZeosDriverModelConexao.Commit: iConexao;
begin
  Result := Self;
  FConnection.Commit;
end;

function TZeosDriverModelConexao.Conectar: iConexao;
begin
  Result := Self;
  FConnection.Connected := true;
end;

function TZeosDriverModelConexao.&End: TComponent;
begin
  Result := FConnection;
end;

function TZeosDriverModelConexao.LimitCacheRegister(Value: Integer): iConexao;
begin
  Result := Self;
  FLimitCacheRegister := Value;
end;

function TZeosDriverModelConexao.Connection: TCustomConnection;
begin
  raise Exception.Create('Função não suportada para este driver');
end;

constructor TZeosDriverModelConexao.Create(Connection : TZConnection);
begin
  FConnection := Connection;
  FCache := TTBGConnectionModelProxy.New(FLimitCacheRegister);
end;

destructor TZeosDriverModelConexao.Destroy;
begin

  inherited;
end;

class function TZeosDriverModelConexao.New(Connection : TZConnection) : iConexao;
begin
  Result := Self.Create(Connection);
end;

function TZeosDriverModelConexao.RollbackTransaction: iConexao;
begin
  Result := Self;
  FConnection.Rollback;
end;

function TZeosDriverModelConexao.StartTransaction: iConexao;
begin
  Result := Self;
  FConnection.StartTransaction;
end;

end.

